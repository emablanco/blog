apt install nis

nis = funciona como cliente o servidor. dependiendo de la configuracion que le demos..

nvim /etc/default/nis


NISSERVER=master
	

Las ip que tienen acceso al servicio de nis

```BASH

#
# /etc/defaults/nis	Optional configuration settings for the NIS programs.
#

#
# The following two variables are still used in the init script, but
# ignored by systemd. See `nis.debian.howto` in the documentation
# directory for more information.
#
# Are we a NIS server and if so what kind (values: false, slave, master)?
NISSERVER=master
# Are we a NIS client?
NISCLIENT=false

# Location of the master NIS password file (for yppasswdd).
# If you change this make sure it matches with /var/yp/Makefile.
YPPWDDIR=/etc

# Do we allow the user to use ypchsh and/or ypchfn ? The YPCHANGEOK
# fields are passed with -e to yppasswdd, see it's manpage.
# Possible values: "chsh", "chfn", "chsh,chfn"
YPCHANGEOK=chsh

# NIS master server.  If this is configured on a slave server then ypinit
# will be run each time NIS is started.
NISMASTER=

# Additional options to be given to ypserv when it is started.
YPSERVARGS=

# Additional options to be given to ypbind when it is started.
YPBINDARGS=

# Additional options to be given to yppasswdd when it is started.  Note
# that if -p is set then the YPPWDDIR above should be empty.
YPPASSWDDARGS=

# Additional options to be given to ypxfrd when it is started.
YPXFRDARGS=
```
 
 
## Configurar redes seguras Yellow Page

Las IP que tienen acceso al directorio de servicios o NIS (Yellow Pages)

Usar en IPv4

```bash
#
# securenets    This file defines the access rights to your NIS server
#               for NIS clients. This file contains netmask/network
#               pairs. A clients IP address needs to match with at least
#               one of those.
#
#               One can use the word "host" instead of a netmask of
#               255.255.255.255. Only IP addresses are allowed in this
#               file, not hostnames.
#
# Always allow access for localhost, IPv4 and IPv6
255.0.0.0       127.0.0.0
host            ::1

# This lines gives access to everybody. PLEASE ADJUST!
0.0.0.0         0.0.0.0
::/0
```

Editar la siguiente linea, la cual si se deja por defecto le permite acceder a todo el mundo

```
# This lines gives access to everybody. PLEASE ADJUST!
0.0.0.0         0.0.0.0
```

Colocar la mascara de red y la IP de la red.


```
# This lines gives access to everybody. PLEASE ADJUST!
255.255.255.0         192.168.1.0
```
con esto ninguna maquina fuera de esta red tendr√° acceso.

## Asignar Domino de NIS

Ahora se debe asignar el dominio de NIS.

Crear archivo **_defaultdomain_**

```
nvim /etc/defaultdomain

ema.local
```

Finalizada la configuracion reiniciar los servicios:

```
systemctl restart rpcbind ypserv yppasswdd ypxfrd
systemctl enable rpcbind ypserv yppasswdd ypxfrd
```

servicio corriendo

[](/assets/imagen/nis/ps.png)

Decirle lo que va a exportar..


nvim /var/yp/Makefile 

Se puede ver los servicios que se van a exporta.

[](/assets/imagen/nis/servicios.png)

En esta parte del archivo se debe editar. Como en los inicio de los sistemas Linux las claves venian en el archivo **passwd** y ahora se encuentran en el archivo **shadow**, se debe agregar.


```
ALL =   passwd group hosts rpc services netid protocols netgrp
#ALL += publickey mail ethers bootparams printcap
#ALL += amd.home auto.master auto.home auto.local
#ALL += timezone locale networks netmasks
```

Editar: Agregar **shadow**.


```
ALL =   passwd shadow group hosts rpc services netid protocols netgrp
#ALL += publickey mail ethers bootparams printcap
#ALL += amd.home auto.master auto.home auto.local
#ALL += timezone locale networks netmasks
```

Iniciar el servidor 

/usr/lib/yp/ypinit -m

El host que colocara como servidor maestro es servidor. Servdior es el nombre del equipo. 

Como solo usare un servidor precionare **\<Control> D**


[](/assets/imagen/nis/ypinit.png)

Realiza un update de las cosas que exportara


[](/assets/imagen/nis/ypinit2.png)

con esto el servicio esta funcionando.


## Cliente

Decirle donde esta su servidor:

Para esto se debe editar el archivo **_/etc/hosts_**



[](/assets/imagen/nis/host.png)


decirle donde esta su servidor.

nvim /etc

este cliente pertenece al dominio ema.local y el servidor que se encarga de administrar este dominio es servidor

[](/assets/imagen/nis/yp.png)


Editar el archivo nisswitch.conf


Que servicio de los usuarios vienen por medio del NIS

passwd es parte de systemd y de NIS

group es parte de systemd y de NIS

shadow solo es parte de NIS


[](/assets/imagen/nis/nis-cliente.png)


en nvim /etc/defaultdomain agregar : ema.local


reiniciar servicios :

```
systemctl restart rpcbind nscd ypbind
systemctl enable rpcbind nscd ypbind
```

[](/assets/imagen/nis/ps2.png)


Cuando iniciemos sesion con el usuario del nis no entrara al home, porque el home esta en el servidor y no en la maquina cliente. para esto se podria utilizar nfs, y exportar todo el home del servidor a toda la red, para que los usarios siempre entren en a su home..