---
layout: single

title:  Router Quagga - Enrutamiento OSPF

excerpt: "**Quagga es un conjunto de herramientas que permiten implementar en un sistema Linux los protocolos de enrutamiento OSPF, RIP y BGP, gestionando, para ello, la tabla de enrutamiento del propio núcleo del sistema. Utiliza un manejo y sintaxis parecida a la que usan los routers de CISCO. Es un proyecto paralelo al proyecto original GNU Zebra, del cual se separó.**"


date: 2023-02-13

classes: wide

header:

    teaser: /assets/images/quagga/logo.png

    teaser_home_page: true
    
    icon: /assets/images/logofairy.png

categories:

    - Debian
    - Router
    - Quagga
    - OSPF


tags:  

- quagga 
- Zebra
- Router

---

<p style="text-align:center;">
  
  <img src="/assets/images/quagga/wallpaper.png" alt="Logo">

</p>

## Quagga 

Quagga es un software formado por un conjunto de demonios que ejecutan distintos protocolos de routing y que convierten un PC con GNU/Linux en un router totalmente funcional.
Unos de los software que incluye Quagga es Zebra, el cual modifica la tabla de enrutamiento del núcleo del sistema, con la informacion que le devuelve el protocolo utilizado (OSPF, RIP y/o BGP). Estos protocolos le indican a Zebra qué modificaciones debe realizar en la tabla de enrutamiento.

![](/assets/images/quagga/quagga_sistema.jpg)

El protocolo que utilizare es OSPF (Open Shortest Path First - Primer camino más corto abierto). Los routers que lo utilzan intercambian entre sí las subredes a las que están conectados y,cada router calcula el camino más corto para llegar al resto de routers en la red mediante el algoritmo Dijkstra.

[OSPF](https://www.ticarte.com/sites/su/users/7/file/enrutamiento-ospf.pdf)

##PREPARACION DEL AREA DE TRABAJO

Esta practica la realizare en mi servidor de virtualizacion QEMU/KVM. Creare 3 maquinas virtuales con DEBIAN11 y le instalare el paquete de herramientas QUAGGA.

### CREACIÓN DE INTERFACES VIRTUALES QEMU/KVM

```bash

#! /bin/bash

echo "Creacion de las interfaces"

echo "CREACION DE RED DMZ"

ip link add link br0 name dmz type vlan id 100

ip addr add 192.168.100.1/24 brd 192.168.100.255 dev dmz

ip link set dmz up


echo "CREACION DE PRIVADA 1"

ip link add link br0 name lan1 type vlan id 101

ip addr add 192.168.101.1/24 brd 192.168.101.1 dev lan1

ip link set lan1 up


echo "CREACION DE RED PRIVADA 2"

ip link add link br0 name lan2 type vlan id 102

ip addr add 192.168.102.1/24 brd 192.168.102.255 dev lan2

ip link set lan2 up


echo "CREACION DE RED PRIVADA 3"

ip link add link br0 name route1 type vlan id 103

ip addr add 200.34.30.1/24 brd 200.34.30.255 dev route1

ip link set route1 up


echo "CREACION DE RED PRIVADA 4"

ip link add link br0 name route2 type vlan id 104

ip addr add 200.34.32.1/24 brd 200.34.32.255 dev route2

ip link set route2 up


echo "CREACION DE RED PRIVADA 5"

ip link add link br0 name route3 type vlan id 105

ip addr add 200.34.34.1/24 brd 200.34.34.255 dev route3

ip link set route3 up


echo "Fin de las interfaces"

```

Una vez que las interfaces virtuales ya estan creadas, creare las maquinas virtuales con "**virt-manager**".

![](/assets/images/quagga/maquinas.png)

Cada maquina cuenta con una direccion IP estatica. 

* Router1: 192.168.1.110
* Router2: 192.168.1.111 
* Router3: 192.168.1.112

## INSTALACION

La instalación de Quagga es muy sencilla, ya que se encuentra en los repositorios de Debian10, no en los repositorios de Debian11.

```bash

deb http://ftp.de.debian.org/debian buster main 

```

Como el trafico pasara de una interfaz a la otra, es necesario habilitar el ip forwarding

```bash
    
    vi /etc/sysctl.conf 

```

En este archivo se debe descomentar la siguiente linea **net.ipv4.ip_forward=1**


```bash

    apt update

    apt install quagga

```

![](/assets/images/quagga/quagga_sistema.jpg)


## CONFIGURACIÓN ZEBRA Y OSPF

### ZEBRA

Crear el ficher zebra.conf

```bash

  vi /etc/quagga/zebra.conf

```

! NOMBRE DEL HOST
hostname router1.local


!CLAVE PARA ACCEDER VTY
password clave

!CLAVE DE ACCESO PARA CONFIGURAR VTY
enable password clave

### OSPF

Crear el fichero ospfd.conf


```bash

vi /etc/quagga/ospfd.conf


```
!NOMBRE DEL HOST
hostname router1.local


!CLAVE DE ACCESO PARA VTY
password clave


!CLAVE DE ACCESO PARA CONFIGURAR VTY
enable password clave


!INTERFACES
interface enp1s0
interface lo


! Identificador del router
! Redes anunciadas y área a la que pertenecen
router ospf

  ospf router-id 192.168.1.110

  network 192.168.1.0/24 area 0.0.0.0

  network 200.34.30.0/24 area 0.0.0.0


!Habilita el acceso por terminal VTY

line vty

### PUERTOS

En el fichero /etc/services se puede ver la asignación de puertos a cada uno de los procesos de Quagga:


![](/assets/images/quagga/puertos.png)


Este proceso se debe realizar en vada uno de los host que trabajaran como router. 

## CONFIGURACIÓN DE INTERFACES DE RED

Cada interfaz tendra su configuracion.

```bash

#! /bin/bash
echo "Creacion de las interfaces"
ip link add link enp7s0 name route1 type vlan id 103
ip addr add 200.34.30.1/24 brd 200.34.30.255 dev route1
ip link set enp7s0 up
echo "nameserver 1.1.1.1" > /etc/resolv.conf

```

## CONFIGURAR EQUIPOS DENTRO DE CADA RED PRIVADA 

Agregare un Equipo dentro de cada red privada que. Esta configuracion se debe realizar en cada equipo con su IP correcta.

```bash

#! /bin/bash
ip link add link enp1s0 name route1 type vlan id 103
ip addr add 200.34.30.2/24 brd 200.34.30.255 dev route1
ip link set route1 up
ip route add default via 200.34.30.1
echo "nameserver 1.1.1.1" > /etc/resolv.conf

#esta linea la ejecuto porque el equipo que coloque en la red tenia una IP estatica
#ip addr del 192.168.1.8/24 dev enp1s0

```

Finalizada la configuracion realizare un PING desde una red privada a otra.

![](/assets/images/quagga/enrutamiento.jpg)

Con la herramienta Traceroute se puede ver el paso por los diferentes router hasta llegar al equipo con el que quiere comunicar.


![](/assets/images/quagga/traceroute.png)
